================================================================================
                              AVITO RENTAL BOT
                    Автоматизированный агент по аренде недвижимости
================================================================================

Автор:    ZerX
Версия:   1.1.0
Дата:     04.08.2025
Лицензия: MIT

================================================================================
                                   ОПИСАНИЕ
================================================================================

Avito Rental Bot - это интеллектуальный бот для автоматизации работы агента
по аренде недвижимости на платформе Avito. Бот использует ChatGPT для 
генерации естественных ответов клиентам и автоматически собирает всю 
необходимую информацию для оформления заявки.

ОСНОВНЫЕ ФУНКЦИИ:
- Автоматические ответы клиентам в мессенджере Avito
- Сбор полной информации о потенциальных арендаторах  
- Интеллектуальная система follow-up сообщений
- Отправка готовых заявок в Telegram
- Работа только в рабочие часы (9:30-21:00 МСК)
- Поддержка нескольких диалогов одновременно

================================================================================
                               ТРЕБОВАНИЯ
================================================================================

СИСТЕМНЫЕ ТРЕБОВАНИЯ:
- Python 3.8 или выше
- Linux/MacOS/Windows
- Интернет соединение
- Минимум 512 MB RAM

ВНЕШНИЕ СЕРВИСЫ:
- Avito API (нужны Client ID и Client Secret)
- OpenAI API (ChatGPT)
- Telegram Bot API

PYTHON ЗАВИСИМОСТИ:
- aiohttp
- asyncio
- json
- datetime

================================================================================
                                 УСТАНОВКА
================================================================================

1. КЛОНИРОВАНИЕ ПРОЕКТА:
   git clone <repository-url>
   cd avito-rental-bot

2. УСТАНОВКА ЗАВИСИМОСТЕЙ:
   pip install aiohttp

3. НАСТРОЙКА КОНФИГУРАЦИИ:
   Отредактируйте файл config.py:
   
   - AVITO_USER_ID = ваш_ID_пользователя_авито
   - AVITO_CLIENT_ID = "ваш_клиент_ID"
   - AVITO_CLIENT_SECRET = "ваш_секретный_ключ"
   - OPENAI_API_KEY = "ваш_ключ_openai"
   - TELEGRAM_BOT_TOKEN = "токен_вашего_бота"
   - TELEGRAM_CHAT_ID = "ID_чата_для_уведомлений"

4. ТЕСТИРОВАНИЕ:
   python test.py

================================================================================
                                 ЗАПУСК
================================================================================

РАЗОВЫЙ ЗАПУСК:
python main.py

ЗАПУСК В ФОНЕ (Linux/MacOS):
nohup python main.py > bot.log 2>&1 &

УСТАНОВКА КАК СИСТЕМНЫЙ СЕРВИС:
sudo bash avito-bot-setup.sh

УПРАВЛЕНИЕ СЕРВИСОМ:
sudo systemctl start avito-rental-bot
sudo systemctl stop avito-rental-bot
sudo systemctl restart avito-rental-bot
sudo systemctl status avito-rental-bot

ПРОСМОТР ЛОГОВ:
sudo journalctl -u avito-rental-bot -f

================================================================================
                             СТРУКТУРА ПРОЕКТА
================================================================================

avito-rental-bot/
├── main.py                 # Основной файл приложения
├── config.py               # Конфигурация и настройки
├── chat_gpt.py             # Интеграция с OpenAI API
├── avito.py                # Клиент для работы с Avito API
├── telegram.py             # Отправка уведомлений в Telegram
├── test.py                 # Тестирование всех компонентов
├── avito-bot-setup.sh      # Скрипт установки systemd сервиса
└── README.txt              # Данная документация

================================================================================
                           АЛГОРИТМ РАБОТЫ БОТА
================================================================================

1. МОНИТОРИНГ СООБЩЕНИЙ:
   - Проверка новых сообщений каждые 5 секунд
   - Обработка сообщений за последние 3 часа
   - Фильтрация уже обработанных диалогов

2. ГЕНЕРАЦИЯ ОТВЕТОВ:
   - Анализ контекста диалога через ChatGPT
   - Определение этапа сбора информации
   - Генерация персонализированного ответа

3. СБОР ИНФОРМАЦИИ:
   Бот последовательно собирает:
   - Состав проживающих (пол/возраст)
   - Информацию о детях и животных
   - Имя клиента
   - Срок аренды
   - Дату заселения
   - Контактный телефон

4. FOLLOW-UP СИСТЕМА:
   - 2 часа: "Смс дошло до Вас?"
   - 16 часов: "Вы просто мимо проходили или Вам действительно интересно?"
   - 2 дня: "Как дела у Вас? Квартира еще интересна?"
   - 4 дня: "А я всё жду тебя, сижу и жду тебя..."

5. ЗАВЕРШЕНИЕ:
   - Извлечение структурированных данных
   - Отправка заявки в Telegram
   - Остановка follow-up сообщений

================================================================================
                               НАСТРОЙКИ
================================================================================

ОСНОВНЫЕ ПАРАМЕТРЫ (config.py):

CHECK_INTERVAL = 5                    # Интервал проверки сообщений (сек)
TIME_WINDOW_HOURS = 3                 # Окно обработки сообщений (часы)  
MAX_MESSAGES_HISTORY = 30             # Максимум сообщений для контекста
FOLLOWUP_CHECK_INTERVAL = 1800        # Проверка follow-up (секунды)

РАБОЧИЕ ЧАСЫ:
WORK_HOUR_START = 9.5                 # Начало рабочего дня (9:30)
WORK_HOUR_END = 21.0                  # Конец рабочего дня (21:00)

МОДЕЛЬ CHATGPT:
OPENAI_MODEL = "gpt-4o-mini"          # Используемая модель OpenAI

================================================================================
                              ТЕСТИРОВАНИЕ
================================================================================

ЗАПУСК ТЕСТОВ:
python test.py

ТЕСТЫ ВКЛЮЧАЮТ:
- Подключение к Avito API
- Генерацию ответов ChatGPT  
- Систему follow-up сообщений
- Отправку уведомлений в Telegram
- Извлечение данных клиентов

ТЕСТОВЫЙ РЕЖИМ:
- Все ответы выводятся в консоль
- Реальная отправка сообщений отключена
- Безопасное тестирование без воздействия на клиентов

================================================================================
                               МОНИТОРИНГ
================================================================================

ЛОГИ ПРИЛОЖЕНИЯ:
tail -f bot.log                       # Просмотр логов в реальном времени

ЛОГИ SYSTEMD:
journalctl -u avito-rental-bot -f     # Логи сервиса
journalctl -u avito-rental-bot --since today  # Логи за сегодня

ПРОВЕРКА СТАТУСА:
systemctl status avito-rental-bot     # Состояние сервиса
ps aux | grep main.py                 # Проверка процесса

ОТЛАДОЧНАЯ ИНФОРМАЦИЯ:
- Номера обрабатываемых чатов
- Тексты отправляемых ответов
- Результаты извлечения данных
- Время follow-up сообщений

================================================================================
                           УСТРАНЕНИЕ НЕПОЛАДОК
================================================================================

ПРОБЛЕМА: Бот не отвечает на сообщения
РЕШЕНИЕ: 
- Проверьте настройки Avito API в config.py
- Убедитесь что AVITO_USER_ID корректный
- Проверьте логи на ошибки авторизации

ПРОБЛЕМА: Неправильные ответы от ChatGPT
РЕШЕНИЕ:
- Проверьте OPENAI_API_KEY
- Убедитесь что на счету OpenAI есть средства
- Проверьте модель OPENAI_MODEL

ПРОБЛЕМА: Не приходят уведомления в Telegram  
РЕШЕНИЕ:
- Проверьте TELEGRAM_BOT_TOKEN
- Убедитесь что TELEGRAM_CHAT_ID правильный
- Добавьте бота в нужный чат

ПРОБЛЕМА: Follow-up сообщения не отправляются
РЕШЕНИЕ:
- Проверьте рабочие часы WORK_HOUR_START/END
- Убедитесь что время сервера корректное
- Проверьте интервал FOLLOWUP_CHECK_INTERVAL

================================================================================
                              ПРОИЗВОДИТЕЛЬНОСТЬ
================================================================================

РЕКОМЕНДУЕМЫЕ НАСТРОЙКИ:
- CHECK_INTERVAL: 5-10 секунд для активной работы
- MAX_MESSAGES_HISTORY: 20-30 для оптимального контекста
- Используйте gpt-4o-mini для экономии API запросов

МАСШТАБИРОВАНИЕ:
- Поддержка до 100 одновременных диалогов
- Автоматическое управление rate limits API
- Эффективное использование памяти

ОПТИМИЗАЦИЯ:
- Кэширование токенов Avito API
- Батчевая обработка сообщений
- Умные интервалы проверки

================================================================================
                                БЕЗОПАСНОСТЬ
================================================================================

РЕКОМЕНДАЦИИ:
- Храните config.py в безопасном месте
- Не публикуйте API ключи в открытом доступе
- Регулярно обновляйте зависимости
- Используйте отдельного пользователя для сервиса

ПРАВА ДОСТУПА:
chmod 600 config.py                   # Только владелец может читать
chown bot-user:bot-group /path/to/bot # Отдельный пользователь

FIREWALL:
- Разрешите исходящие соединения к API
- Заблокируйте входящие соединения

================================================================================
                               ПОДДЕРЖКА
================================================================================

АВТОР: ZerX
EMAIL: zerx.dev@yandex.ru
ДОКУМЕНТАЦИЯ: README.txt
ВЕРСИЯ: 1.1.0

ИЗВЕСТНЫЕ ОГРАНИЧЕНИЯ:
- Работает только с текстовыми сообщениями
- Требует стабильного интернет соединения  
- Зависит от доступности внешних API